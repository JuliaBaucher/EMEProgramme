<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EME ‚Äî Assistant (Extended Monaco Entreprises)</title>
  <meta name="description" content="Assistant officiel du programme Extended Monaco Entreprises (EME) ‚Äî Acc√©l√©rateur de la transformation num√©rique des entreprises mon√©gasques." />
  <meta name="color-scheme" content="light dark" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Keep these (used by your local rendering) -->
  <script defer src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/dompurify@3.0.11/dist/purify.min.js"></script>

  <style>
    :root{
      --monaco-red:#CE1126; --monaco-red-rgb:206,17,38;
      --monaco-white:#fff; --monaco-white-rgb:255,255,255;

      --primary-blue:#003366; --primary-blue-rgb:0,51,102;
      --secondary-blue:#0066CC; --secondary-blue-rgb:0,102,204;

      --gray-900:#212529; --gray-800:#343A40; --gray-700:#495057;
      --gray-600:#6C757D; --gray-500:#ADB5BD; --gray-400:#CED4DA;
      --gray-300:#DEE2E6; --gray-200:#E9ECEF; --gray-100:#F8F9FA;

      --font-primary:'Source Sans Pro','Helvetica Neue',Helvetica,Arial,sans-serif;
      --font-secondary:'Roboto','Source Sans Pro',sans-serif;
      --font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace;

      --text-xs:0.75rem; --text-sm:0.875rem; --text-base:1rem; --text-lg:1.125rem; --text-xl:1.25rem;

      --leading-tight:1.25; --leading-normal:1.5; --leading-relaxed:1.75;

      --space-1:0.25rem; --space-2:0.5rem; --space-3:0.75rem; --space-4:1rem;
      --space-6:1.5rem; --space-8:2rem; --space-12:3rem;

      --radius-sm:0.125rem; --radius-md:0.375rem; --radius-lg:0.5rem; --radius-full:9999px;

      --shadow-sm:0 1px 2px 0 rgba(0,0,0,0.05);
      --shadow-md:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);

      --container-max-width:1280px;
      --bubble-user-bg:rgba(var(--secondary-blue-rgb),0.10);
      --bubble-assistant-bg:rgba(0,0,0,0.03);
      --bubble-system-bg:rgba(var(--monaco-red-rgb),0.08);

      --header-height:84px;
      --input-max-chars:4000;
    }

    :root[data-theme="dark"]{
      --gray-100:#0b1220; --gray-200:#111a2e;
      --gray-300:rgba(255,255,255,0.12); --gray-400:rgba(255,255,255,0.18);
      --gray-500:rgba(255,255,255,0.28); --gray-600:rgba(255,255,255,0.55);
      --gray-700:rgba(255,255,255,0.75); --gray-800:rgba(255,255,255,0.88);
      --gray-900:rgba(255,255,255,0.96);

      --bubble-assistant-bg:rgba(255,255,255,0.06);
      --bubble-user-bg:rgba(var(--secondary-blue-rgb),0.18);
      --bubble-system-bg:rgba(var(--monaco-red-rgb),0.18);
    }

    @media (prefers-color-scheme:dark){
      :root:not([data-theme]){
        --gray-100:#0b1220; --gray-200:#111a2e;
        --gray-300:rgba(255,255,255,0.12); --gray-400:rgba(255,255,255,0.18);
        --gray-500:rgba(255,255,255,0.28); --gray-600:rgba(255,255,255,0.55);
        --gray-700:rgba(255,255,255,0.75); --gray-800:rgba(255,255,255,0.88);
        --gray-900:rgba(255,255,255,0.96);

        --bubble-assistant-bg:rgba(255,255,255,0.06);
        --bubble-user-bg:rgba(var(--secondary-blue-rgb),0.18);
        --bubble-system-bg:rgba(var(--monaco-red-rgb),0.18);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font-primary);
      color:var(--gray-800);
      background:linear-gradient(180deg,var(--gray-100),var(--gray-200));
      line-height:var(--leading-normal);
    }

    a{color:var(--secondary-blue);text-decoration:none}
    a:hover{text-decoration:underline}

    .skip-link{
      position:absolute; top:-40px; left:6px;
      background:var(--primary-blue); color:var(--monaco-white);
      padding:var(--space-2) var(--space-4);
      border-radius:var(--radius-md);
      z-index:1000;
    }
    .skip-link:focus{top:6px;outline:2px solid var(--secondary-blue);outline-offset:2px}

    .container{max-width:var(--container-max-width);margin:0 auto;padding:var(--space-6) var(--space-4)}

    header.gov-header{
      background:var(--primary-blue);
      color:var(--monaco-white);
      box-shadow:var(--shadow-md);
      position:sticky; top:0; z-index:10;
    }
    .gov-header__inner{
      max-width:var(--container-max-width);
      margin:0 auto;
      padding:var(--space-4);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:var(--space-4);
      min-height:var(--header-height);
    }
    .brand{display:flex;align-items:center;gap:var(--space-3);min-width:0}
    .flag{width:34px;height:22px;border-radius:3px;overflow:hidden;box-shadow:0 0 0 1px rgba(255,255,255,0.25);flex:0 0 auto}
    .flag__top{height:50%;background:var(--monaco-white)}
    .flag__bottom{height:50%;background:var(--monaco-red)}
    .brand__text{display:flex;flex-direction:column;gap:2px;min-width:0}
    .brand__title{
      font-family:var(--font-secondary);
      font-weight:600;
      font-size:var(--text-lg);
      margin:0;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .brand__subtitle{
      margin:0;
      font-size:var(--text-sm);
      color:rgba(255,255,255,0.85);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .header-actions{display:flex;align-items:center;gap:var(--space-2);flex:0 0 auto}
    .btn{
      border:2px solid transparent;
      border-radius:var(--radius-md);
      padding:var(--space-2) var(--space-4);
      font:inherit;
      font-weight:500;
      cursor:pointer;
      transition:transform .15s ease, box-shadow .15s ease, background-color .15s ease, border-color .15s ease;
      display:inline-flex; align-items:center; gap:var(--space-2);
      background:transparent; color:var(--monaco-white);
    }
    .btn:focus{outline:2px solid var(--secondary-blue);outline-offset:2px}
    .btn--ghost{border-color:rgba(255,255,255,0.25)}
    .btn--ghost:hover{border-color:rgba(255,255,255,0.45);transform:translateY(-1px)}
    .btn--primary{background:var(--secondary-blue);border-color:var(--secondary-blue)}
    .btn--primary:hover{background:var(--primary-blue);border-color:var(--primary-blue);transform:translateY(-1px);box-shadow:var(--shadow-sm)}

    .main{min-height:calc(100vh - var(--header-height,84px))}
    .layout{
      display:grid;
      grid-template-columns:1fr 320px;
      gap:var(--space-6);
      align-items:start;
    }
    .content{min-width:0}
    .sidebar{
      position:sticky;
      top:var(--space-6);
      max-height:calc(100vh - var(--header-height,84px) - var(--space-12));
      overflow:auto;
      padding-right:var(--space-2);
    }
    @media (max-width:1024px){
      .layout{grid-template-columns:1fr}
      .sidebar{position:static;max-height:none;overflow:visible;padding-right:0}
    }

    .card{
      background:var(--monaco-white);
      border:1px solid var(--gray-300);
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-sm);
      overflow:hidden;
    }
    :root[data-theme="dark"] .card{background:rgba(255,255,255,0.04)}
    @media (prefers-color-scheme:dark){ :root:not([data-theme]) .card{background:rgba(255,255,255,0.04)} }

    .card__header{
      padding:var(--space-6);
      border-bottom:1px solid var(--gray-300);
      display:flex;align-items:center;justify-content:space-between;gap:var(--space-4);
    }
    .card__title{
      font-family:var(--font-secondary);
      font-size:var(--text-xl);
      font-weight:600;
      color:var(--primary-blue);
      margin:0;
      line-height:var(--leading-tight);
    }
    :root[data-theme="dark"] .card__title{color:rgba(255,255,255,0.95)}
    @media (prefers-color-scheme:dark){ :root:not([data-theme]) .card__title{color:rgba(255,255,255,0.95)} }

    .monaco-accent{border-left:4px solid var(--monaco-red);padding-left:var(--space-4)}

    /* Chat card layout */
    .chat{
      display:flex;
      flex-direction:column;
      height:min(84vh, 980px);
    }

    .chat__disclaimer{
      padding:var(--space-4) var(--space-6);
      border-bottom:1px solid var(--gray-300);
      background:rgba(0,0,0,0.015);
      font-size:var(--text-sm);
      color:var(--gray-700);
    }
    :root[data-theme="dark"] .chat__disclaimer{background:rgba(255,255,255,0.03)}
    @media (prefers-color-scheme:dark){ :root:not([data-theme]) .chat__disclaimer{background:rgba(255,255,255,0.03)} }

    .chat__messages{
      padding:var(--space-6);
      overflow:auto;
      flex:1 1 auto;
      display:flex;
      flex-direction:column;
      gap:var(--space-4);
    }

    /* Empty-state panel */
    .empty-panel{
      border:1px dashed var(--gray-300);
      border-radius:var(--radius-lg);
      padding:var(--space-6);
      background:rgba(0,0,0,0.01);
    }
    :root[data-theme="dark"] .empty-panel{background:rgba(255,255,255,0.03)}
    .empty-panel__title{
      margin:0 0 var(--space-3);
      font-family:var(--font-secondary);
      font-weight:600;
      font-size:var(--text-lg);
      color:var(--gray-800);
    }
    :root[data-theme="dark"] .empty-panel__title{color:rgba(255,255,255,0.95)}
    .empty-panel__hint{
      margin:0 0 var(--space-4);
      color:var(--gray-700);
      font-size:var(--text-sm);
      line-height:var(--leading-relaxed);
    }

    .quick-questions{
      display:flex;
      flex-wrap:wrap;
      gap:var(--space-2);
    }

    /* Message bubbles */
    .msg{display:flex;gap:0;margin-bottom:var(--space-4);align-items:flex-start}
    .msg__avatar{display:none}
    .msg__bubble{
      max-width:100%;
      padding:var(--space-4);
      border-radius:var(--radius-lg);
      border:1px solid var(--gray-300);
      box-shadow:var(--shadow-sm);
      background:var(--bubble-assistant-bg);
      color:var(--gray-800);
      min-width:0;
      width:100%;
    }
    .msg--user .msg__bubble{background:var(--bubble-user-bg);border-color:rgba(var(--secondary-blue-rgb),0.35)}
    .msg--system .msg__bubble{background:var(--bubble-system-bg);border-color:rgba(var(--monaco-red-rgb),0.35)}

    .msg__meta{display:flex;gap:var(--space-3);align-items:baseline;margin-bottom:var(--space-2);color:var(--gray-600);font-size:var(--text-xs)}
    .msg__role{font-weight:600;color:var(--gray-700)}
    .msg__content{white-space:pre-wrap;overflow-wrap:anywhere;font-size:var(--text-base);line-height:var(--leading-relaxed)}
    .msg__actions{margin-top:var(--space-3);display:flex;gap:var(--space-2);flex-wrap:wrap}

    .chip{
      font-size:var(--text-xs);
      padding:0.35rem 0.55rem;
      border-radius:var(--radius-full);
      border:1px solid var(--gray-300);
      background:rgba(0,0,0,0.03);
      color:var(--gray-700);
      cursor:pointer;
      transition:transform .15s ease, box-shadow .15s ease, background-color .15s ease;
    }
    .chip:hover{transform:translateY(-1px);box-shadow:var(--shadow-sm)}
    .chip:focus{outline:2px solid var(--secondary-blue);outline-offset:2px}

    .composer{
      border-top:1px solid var(--gray-300);
      padding:var(--space-4);
      background:rgba(0,0,0,0.015);
    }
    :root[data-theme="dark"] .composer{background:rgba(255,255,255,0.03)}
    @media (prefers-color-scheme:dark){ :root:not([data-theme]) .composer{background:rgba(255,255,255,0.03)} }

    .composer__row{display:flex;gap:var(--space-3);align-items:flex-end}
    .textarea-wrap{flex:1 1 auto;display:flex;flex-direction:column;gap:var(--space-2);min-width:0}

    textarea{
      width:100%;
      resize:none;
      min-height:72px;
      max-height:220px;
      padding:var(--space-3);
      border-radius:var(--radius-md);
      border:2px solid var(--gray-400);
      background:var(--monaco-white);
      color:var(--gray-900);
      font-family:var(--font-primary);
      font-size:var(--text-base);
      line-height:var(--leading-normal);
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    :root[data-theme="dark"] textarea{background:rgba(255,255,255,0.06);color:var(--gray-900)}
    @media (prefers-color-scheme:dark){ :root:not([data-theme]) textarea{background:rgba(255,255,255,0.06);color:var(--gray-900)} }
    textarea:focus{outline:none;border-color:var(--secondary-blue);box-shadow:0 0 0 3px rgba(var(--secondary-blue-rgb),0.12)}

    .counter{display:flex;justify-content:space-between;align-items:center;font-size:var(--text-xs);color:var(--gray-600)}
    .counter__hint kbd{
      font-family:var(--font-mono);
      font-size:0.95em;
      border:1px solid var(--gray-400);
      border-bottom-width:2px;
      border-radius:var(--radius-sm);
      padding:0.05em 0.35em;
      background:rgba(0,0,0,0.03);
    }
    .counter__count{
      font-variant-numeric:tabular-nums;
      padding:0.15rem 0.5rem;
      border-radius:var(--radius-full);
      border:1px solid var(--gray-300);
      background:rgba(0,0,0,0.03);
    }
    .counter__count.warn{background:rgba(255,193,7,0.2);border-color:rgba(255,193,7,0.5);color:var(--gray-800)}
    .counter__count.danger{background:rgba(220,53,69,0.18);border-color:rgba(220,53,69,0.45);color:var(--gray-900)}

    .send-btn{
      flex:0 0 auto;
      min-width:132px;
      height:56px;
      border-radius:var(--radius-md);
      border:2px solid var(--secondary-blue);
      background:var(--secondary-blue);
      color:var(--monaco-white);
      font-weight:500;
      cursor:pointer;
      transition:transform .15s ease, box-shadow .15s ease, background-color .15s ease, border-color .15s ease;
    }
    .send-btn:hover{transform:translateY(-1px);box-shadow:var(--shadow-sm);background:var(--primary-blue);border-color:var(--primary-blue)}
    .send-btn:disabled{opacity:.55;cursor:not-allowed;transform:none;box-shadow:none}

    .icon-btn{
      height:56px;width:56px;
      border-radius:var(--radius-md);
      border:2px solid var(--gray-300);
      background:transparent;
      cursor:pointer;
      color:var(--gray-800);
      display:grid;place-items:center;
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .icon-btn:hover{transform:translateY(-1px);box-shadow:var(--shadow-sm);border-color:var(--gray-400)}
    .send-btn:focus, .icon-btn:focus, .btn:focus{outline:2px solid var(--secondary-blue);outline-offset:2px}

    /* Sidebar */
    .side{padding:var(--space-6)}
    .side h2{font-family:var(--font-secondary);font-size:var(--text-lg);margin:0 0 var(--space-3);color:var(--primary-blue)}
    :root[data-theme="dark"] .side h2{color:rgba(255,255,255,0.95)}
    @media (prefers-color-scheme:dark){ :root:not([data-theme]) .side h2{color:rgba(255,255,255,0.95)} }
    .side p{margin:0 0 var(--space-4);color:var(--gray-700);font-size:var(--text-sm);line-height:var(--leading-relaxed)}
    .quick-links{display:grid;gap:var(--space-2);margin-bottom:var(--space-6)}
    .quick-links a{
      display:inline-flex;align-items:center;justify-content:space-between;gap:var(--space-2);
      padding:var(--space-3) var(--space-4);
      border-radius:var(--radius-md);
      border:1px solid var(--gray-300);
      background:rgba(0,0,0,0.02);
      color:var(--gray-800);
      font-weight:500;
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .quick-links a:hover{transform:translateY(-1px);box-shadow:var(--shadow-sm);border-color:var(--gray-400)}

    footer{padding:var(--space-8) 0;color:var(--gray-600);font-size:var(--text-sm)}

    @media (max-width:768px){
      .gov-header__inner{flex-wrap:wrap}
      .header-actions{width:100%;justify-content:flex-start}
      .chat{height:min(86vh, 1100px)}
      .send-btn{min-width:110px}
      .msg__bubble{max-width:100%}
    }

    /* ====== ChatBuilder iframe embed (NO widget, NO CORS) ====== */
    .embed-note{
      margin:0;
      font-size:var(--text-sm);
      color:var(--gray-700);
    }
    .chat-embed{
      border:1px solid var(--gray-300);
      border-radius:var(--radius-lg);
      overflow:hidden;
      background:rgba(0,0,0,0.01);
      height: min(64vh, 720px);
      min-height: 520px;
    }
    :root[data-theme="dark"] .chat-embed{background:rgba(255,255,255,0.03)}
    .chat-embed__frame{
      width:100%;
      height:100%;
      border:0;
      display:block;
    }
  </style>
</head>

<body>
  <a class="skip-link" href="#chat">Aller au contenu</a>

  <header class="gov-header" role="banner">
    <div class="gov-header__inner">
      <div class="brand" aria-label="Extended Monaco Entreprises">
        <div class="flag" aria-hidden="true">
          <div class="flag__top"></div>
          <div class="flag__bottom"></div>
        </div>
        <div class="brand__text">
          <p class="brand__title">Extended Monaco Entreprises (EME)</p>
          <p class="brand__subtitle">Assistant officiel ‚Äî Transformation num√©rique des entreprises mon√©gasques</p>
        </div>
      </div>

      <div class="header-actions" role="group" aria-label="Actions">
        <button class="btn btn--ghost" id="themeToggle" type="button" aria-label="Basculer le mode clair/sombre">
          üåì <span style="font-size:0.95em;">Th√®me</span>
        </button>
        <button class="btn btn--ghost" id="clearChatTop" type="button" aria-label="Effacer l'historique de conversation">
          üßπ <span style="font-size:0.95em;">Effacer</span>
        </button>
        <a class="btn btn--primary" href="https://eme.gouv.mc/" target="_blank" rel="noopener" aria-label="Ouvrir le site officiel EME">
          üåê <span style="font-size:0.95em;">Site EME</span>
        </a>
      </div>
    </div>
  </header>

  <main class="main" role="main">
    <div class="container">
      <div class="layout">

        <section class="content" aria-label="Zone principale">
          <section class="card chat chat-card" aria-label="Chat EME">
            <div class="card__header">
              <div class="monaco-accent">
                <h1 class="card__title" style="margin:0;">Concierge EME</h1>
                <div style="margin-top:6px;font-size:var(--text-sm);color:var(--gray-700);">
                  Posez vos questions sur : autodiagnostic, annuaire, Fonds Bleu, FlashUP, FlashLearn IA (2026).
                </div>
                <p class="embed-note" style="margin-top:8px;">
                  ‚úÖ Version sans CORS : le chat est embarqu√© via <strong>iframe</strong> (pas de widget vert, pas d‚Äôappel fetch cross-domain).
                </p>
              </div>
              <button class="btn btn--ghost" id="copyTranscript" type="button" aria-label="Copier la conversation">
                üìã <span style="font-size:0.95em;">Copier</span>
              </button>
            </div>

            <div class="chat__disclaimer" id="disclaimer" role="note">
              <strong>Transparence IA :</strong> cet assistant fournit des informations g√©n√©rales sur le programme EME.
              Il ne remplace pas un conseil juridique/financier et ne garantit pas l‚Äô√©ligibilit√© au Fonds Bleu.
              √âvitez de partager des donn√©es sensibles. Besoin d‚Äôun humain ? Consultez la page
              <a href="https://eme.gouv.mc/contact" target="_blank" rel="noopener">Contact</a> ou la
              <a href="https://eme.gouv.mc/" target="_blank" rel="noopener">F.A.Q.</a>.
            </div>

            <!-- IMPORTANT:
                 We keep your chat area, but instead of calling ChatBuilder via fetch (CORS),
                 we embed their webchat UI in an iframe. -->
            <div id="chat" class="chat__messages" tabindex="0" aria-label="Chat embarqu√© (iframe)">
              <div class="chat-embed" aria-label="Chat EME (ChatBuilder)">
                <iframe
                  class="chat-embed__frame"
                  title="Chat EME"
                  src="https://app.chatgptbuilder.io/webchat/?p=1120485&id=dVJHWjXLkq4OhmzmTo"
                  allow="clipboard-read; clipboard-write; microphone; camera"
                  loading="lazy">
                </iframe>
              </div>
            </div>

            <!-- You can keep the composer visually, but it can't drive the iframe without an official postMessage API.
                 So we disable it to avoid confusion. -->
            <div class="composer" aria-label="Zone de saisie (d√©sactiv√©e dans cette version)">
              <div class="composer__row">
                <div class="textarea-wrap">
                  <textarea id="input"
                            placeholder="Saisie d√©sactiv√©e : utilisez le chat int√©gr√© ci-dessus (iframe)."
                            aria-label="Message"
                            maxlength="4000"
                            disabled></textarea>

                  <div class="counter" aria-label="Indicateur de longueur">
                    <div class="counter__hint">
                      <span>Info :</span> cette version √©vite CORS en int√©grant le chat <kbd>iframe</kbd>.
                    </div>
                    <div id="count" class="counter__count">0 / 4000</div>
                  </div>
                </div>

                <button id="send" class="send-btn" type="button" aria-label="Envoyer le message" disabled>Envoyer</button>
                <button id="clearChat" class="icon-btn" type="button" aria-label="Effacer la conversation" disabled>üßπ</button>
              </div>
            </div>
          </section>
        </section>

        <aside class="card side sidebar" aria-label="Aide et ressources">
          <h2>Raccourcis utiles</h2>
          <p>Acc√©dez rapidement aux ressources EME (site officiel).</p>

          <div class="quick-links" role="list">
            <a role="listitem" href="https://eme.gouv.mc/evaluer-sa-maturite-numerique/" target="_blank" rel="noopener">
              Autodiagnostic de maturit√© num√©rique <span aria-hidden="true">‚Üí</span>
            </a>
            <a role="listitem" href="https://eme.gouv.mc/rechercher-un-professionnel-du-numerique/" target="_blank" rel="noopener">
              Annuaire des professionnels du num√©rique <span aria-hidden="true">‚Üí</span>
            </a>
            <a role="listitem" href="https://eme.gouv.mc/programme-de-sensibilisation/" target="_blank" rel="noopener">
              Programme de sensibilisation (FlashUP) <span aria-hidden="true">‚Üí</span>
            </a>
            <a role="listitem" href="https://eme.gouv.mc/flashup-tool-box/" target="_blank" rel="noopener">
              FlashUP Tool Box <span aria-hidden="true">‚Üí</span>
            </a>
            <a role="listitem" href="https://eme.gouv.mc/financer-son-projet-3/" target="_blank" rel="noopener">
              Financer son projet (Fonds Bleu) <span aria-hidden="true">‚Üí</span>
            </a>
          </div>
        </aside>

      </div>

      <footer class="container" role="contentinfo">
        ¬© Extended Monaco Entreprises ‚Äî Interface de d√©monstration (frontend). Pour les informations officielles, consulter le site EME.
      </footer>
    </div>
  </main>

  <script>
    // Theme toggle (kept)
    const THEME_KEY = "eme_theme_v1";
    const themeToggle = document.getElementById("themeToggle");

    function setTheme(theme) {
      if (!theme) {
        document.documentElement.removeAttribute("data-theme");
        localStorage.removeItem(THEME_KEY);
        return;
      }
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem(THEME_KEY, theme);
    }
    function initTheme() {
      const saved = localStorage.getItem(THEME_KEY);
      if (saved === "light" || saved === "dark") setTheme(saved);
    }
    function toggleTheme() {
      const current = document.documentElement.getAttribute("data-theme");
      if (current === "dark") setTheme("light");
      else if (current === "light") setTheme("dark");
      else setTheme("dark");
    }

    // Copy transcript can't access iframe contents (cross-origin).
    // We'll copy a helpful note instead.
    const copyTranscriptBtn = document.getElementById("copyTranscript");
    async function copyTranscript() {
      const text =
        "Le chat est int√©gr√© via iframe (ChatBuilder). " +
        "Pour copier la conversation, utilisez l'option de copie √† l'int√©rieur du chat int√©gr√©.";
      try {
        await navigator.clipboard.writeText(text);
        alert("Note copi√©e : utilisez la copie dans le chat int√©gr√© (iframe).");
      } catch {
        alert("Impossible de copier automatiquement.");
      }
    }

    function init() {
      initTheme();
      themeToggle.addEventListener("click", toggleTheme);
      copyTranscriptBtn.addEventListener("click", copyTranscript);
    }

    window.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
